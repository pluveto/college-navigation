# 2 功能需求说明及分析

组员：

| 姓名   | 学号       |
| ------ | ---------- |
| 张梓靖 | 2019211379 |
| 毛子恒 | 2019211397 |
| 姜山   | 2019211402 |

## 需求说明

- 校园内建筑物（教学楼、办公楼、宿舍楼）数不少于 20 个，其它服务设施不少于 5 种，共 20 个

- 建立校园内部道路图，可以采用学校地图

  - 包括各种建筑物、服务设施等信息
  - 边数大于 200 条
  - 校区个数至少 2 个

- 学生发出起点、终点请求，给出导航策略。

  - 起点和终点可以是物理位置，也可以是逻辑位置
  - 逻辑位置可以和物理位置一对一
  - 起点和终点可以在不同校区，需要考虑校区间的交通
    方式，**定时**或者**间隔一定时间**有校车发出

- 实现四种导航策略：

  - 最短距离策略：距离最短即可

  - 最短时间策略：假设每条道路**拥挤度**不一样，在这种情况下时间最短即可

    > 拥挤度为$ \le 1 $的正数
    > $ 真实速度 \times 拥挤度 = 理想速度$，拥挤度与理想速度自拟

  - 途径最短距离策略：途径某些地点的最短距离

  - 交通工具的最短时间策略：

    - 可选自行车道路，默认自行车在校区任何地点都有
    - 这时在考虑不同拥挤度的情况下时间最短；

- 模拟导航系统以时间为轴向前推移，系统时间**精确到分钟**

- 建立日志文件，对学生状态变化和键入等信息进行记录

- 学生选定路线后，按照路线和设定好的行进速度行进

- 学生可以实时查询自己所处的位置

  - 能够查询周围的建筑物
  - 给出一定范围内的建筑（自拟范围），标出到这些目标的距离最短路线的距离
  - 选定某一个目标给出当前位置到目标的距离最短路线

---

选做部分：

- 中途停止：中途更改目标和导航策略，系统按照当前位置做相应的操作
- 图形化界面：用图形绘制地图，并在地图上进行实时导航
- 绘制建筑内部：在教学楼和宿舍楼中进行导航，能够导航到具体的楼层和房间
- 负载均衡：根据食堂人流量进行负载均衡导航
- 多用户的系统：实时查询任一用户状态

## 需求分析

- [x] 图形界面采用学校地图，满足地图要求（PS等方法合成）
- [x] 后端导入地图并初始化，编码最短路径算法，形成可供前端调用的RESTful接口
- [x] 前端需要在地图上标记，形成地图数据并导入到后端
- [x] 后端储存逻辑位置，导入课程表
- [x] 动态显示用户位置，暂停可查询周边建筑
- [x] 后端把操作写入日志文件
- [x] 前端绘制建筑内部，并调用后端逻辑位置
- [x] 后端实现静态或动态的负载均衡算法

## 输入输出

| 输入内容               | 输入操作                                                   |
| ---------------------- | ---------------------------------------------------------- |
| 起点终点选择           | 先点击选点，之后直接点击地图，或点击坐标框输入逻辑地址搜索 |
| 移动方式选择           | 点击移动方式选项，选择步行或自行车                         |
| 跨校区策略选择         | 点击跨校区策略选项，选择公交、校车或出租车                 |
| 出发时间选择           | 依次在出发时间选项，输入时、分信息                         |
| 寻路策略选择           | 点击寻路策略选项，选择时间优先或距离优先                   |
| 速度倍率和时间流逝选择 | 调节速度倍率和时间流逝选项                                 |
| 步行速度和骑行速度选择 | 在步行速度和骑行速度选项，输入步行速度和骑行速度           |
| 查看路线按键           | 以现在选择的起点、终点和寻路策略给出最优寻路方案           |
| 开始模拟按键           | 开始模拟导航过程                                           |
| 功能菜单附近按键       | 输入搜索半径，搜索附近的位置，按照由近及远依次排序显示     |
| 登录界面用户名密码     | 输入用户名密码登录                                         |

| 输出内容         | 输出操作                                                     |
| ---------------- | ------------------------------------------------------------ |
| 预估时间         | 选择起点和终点，点击查看路线输出                             |
| 导航路线         | 点击查看路线，在地图上显示导航路线                           |
| 逻辑地址搜索     | 选点时点击坐标框，可以解析地址字符串，对逻辑地址进行搜索，并定位到教学楼内部地图 |
| 负载均衡推荐食堂 | 搜索逻辑地址时输入食堂，可以按负载均衡算法进行最优推荐       |
| 附近位置搜索     | 按照输入的半径对当前子图上周围的地图节点进行搜索，并按照距离排序输出 |

## 数据管理

| 数据           | 存储方式   | 操作方式                     |
| -------------- | ---------- | ---------------------------- |
| 地图背景图片   | 上传至图床 | 修改背景图片`url`            |
| 地图所有点集合 | `json`文件 | 通过地图修改器导出`json`文件 |
| 日志文件       | `log`文件  | 前端文件修改                 |
| 时间表         | `txt`文件  | 后端文件修改                 |
| 用户信息       | `json`文件 | 开发者修改，前端文件读取     |

## 故障处理

| 错误类型             | 处理方法 | 处理端 |
| -------------------- | -------- | ------ |
| 未选择起始点或终止点 | 窗口提示 | 前端   |
| 未显示路径就开始导航 | 窗口提示 | 前端   |

